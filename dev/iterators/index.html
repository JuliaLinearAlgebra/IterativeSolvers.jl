<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>The iterator approach · IterativeSolvers.jl</title><meta name="title" content="The iterator approach · IterativeSolvers.jl"/><meta property="og:title" content="The iterator approach · IterativeSolvers.jl"/><meta property="twitter:title" content="The iterator approach · IterativeSolvers.jl"/><meta name="description" content="Documentation for IterativeSolvers.jl."/><meta property="og:description" content="Documentation for IterativeSolvers.jl."/><meta property="twitter:description" content="Documentation for IterativeSolvers.jl."/><meta property="og:url" content="https://julialinearalgebra.github.io/IterativeSolvers.jl/stable/iterators/"/><meta property="twitter:url" content="https://julialinearalgebra.github.io/IterativeSolvers.jl/stable/iterators/"/><link rel="canonical" href="https://julialinearalgebra.github.io/IterativeSolvers.jl/stable/iterators/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">IterativeSolvers.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../getting_started/">Getting started</a></li><li><a class="tocitem" href="../preconditioning/">Preconditioning</a></li><li><span class="tocitem">Linear systems</span><ul><li><a class="tocitem" href="../linear_systems/cg/">Conjugate Gradients</a></li><li><a class="tocitem" href="../linear_systems/chebyshev/">Chebyshev iteration</a></li><li><a class="tocitem" href="../linear_systems/minres/">MINRES</a></li><li><a class="tocitem" href="../linear_systems/bicgstabl/">BiCGStab(l)</a></li><li><a class="tocitem" href="../linear_systems/idrs/">IDR(s)</a></li><li><a class="tocitem" href="../linear_systems/gmres/">Restarted GMRES</a></li><li><a class="tocitem" href="../linear_systems/lsmr/">LSMR</a></li><li><a class="tocitem" href="../linear_systems/lsqr/">LSQR</a></li><li><a class="tocitem" href="../linear_systems/stationary/">Stationary methods</a></li></ul></li><li><span class="tocitem">Eigenproblems</span><ul><li><a class="tocitem" href="../eigenproblems/power_method/">Power method</a></li><li><a class="tocitem" href="../eigenproblems/lobpcg/">LOBPCG</a></li></ul></li><li><a class="tocitem" href="../svd/svdl/">SVDL</a></li><li class="is-active"><a class="tocitem" href>The iterator approach</a><ul class="internal"><li><a class="tocitem" href="#How-iterators-are-implemented"><span>How iterators are implemented</span></a></li><li><a class="tocitem" href="#Example:-avoiding-unnecessary-initialization"><span>Example: avoiding unnecessary initialization</span></a></li><li><a class="tocitem" href="#Other-use-cases"><span>Other use cases</span></a></li></ul></li><li><span class="tocitem">About</span><ul><li><a class="tocitem" href="../about/CONTRIBUTING/">Contributing</a></li><li><a class="tocitem" href="../about/license/">License</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>The iterator approach</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>The iterator approach</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaLinearAlgebra/IterativeSolvers.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaLinearAlgebra/IterativeSolvers.jl/blob/master/docs/src/iterators.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Iterators"><a class="docs-heading-anchor" href="#Iterators">Iterative solvers as iterators</a><a id="Iterators-1"></a><a class="docs-heading-anchor-permalink" href="#Iterators" title="Permalink"></a></h1><p>In advanced use cases you might want to access the internal data structures of the solver, inject code to be run after each iteration, have total control over allocations or reduce overhead in initialization. The iterator approach of IterativeSolvers.jl makes this possible.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>At this point <a href="../linear_systems/bicgstabl/#BiCGStabl">BiCGStab(l)</a>, <a href="../linear_systems/cg/#CG">CG</a>, <a href="../linear_systems/chebyshev/#Chebyshev">Chebyshev</a>, <a href="../linear_systems/gmres/#GMRES">GMRES</a>, <a href="../linear_systems/minres/#MINRES">MINRES</a>, <a href="../linear_systems/qmr/#QMR">QMR</a> and the <a href="../linear_systems/stationary/#Stationary">stationary methods</a> are implemented as iterators. However, the package does not yet export the iterators and helper methods themselves.</p></div></div><h2 id="How-iterators-are-implemented"><a class="docs-heading-anchor" href="#How-iterators-are-implemented">How iterators are implemented</a><a id="How-iterators-are-implemented-1"></a><a class="docs-heading-anchor-permalink" href="#How-iterators-are-implemented" title="Permalink"></a></h2><p>The solvers listed above are basically a thin wrapper around an iterator. Among other things, they initialize the iterable, loop through the iterator and return the result:</p><pre><code class="language-julia hljs">function my_solver!(x, A, b)
    iterable = MySolverIterable(x, A, b)
    for item in iterable end
    return iterable.x
end</code></pre><p>Rather than calling <code>my_solver!(x, A, b)</code>, you could also initialize the iterable yourself and perform the <code>for</code> loop.</p><h2 id="Example:-avoiding-unnecessary-initialization"><a class="docs-heading-anchor" href="#Example:-avoiding-unnecessary-initialization">Example: avoiding unnecessary initialization</a><a id="Example:-avoiding-unnecessary-initialization-1"></a><a class="docs-heading-anchor-permalink" href="#Example:-avoiding-unnecessary-initialization" title="Permalink"></a></h2><p>The Jacobi method for <code>SparseMatrixCSC</code> has some overhead in initialization; not only do we need to allocate a temporary vector, we also have to search for indices of the diagonal (and check their values are nonzero). The current implementation initializes the iterable as:</p><pre><code class="language-julia hljs">jacobi_iterable(x, A::SparseMatrixCSC, b; maxiter::Int = 10) =
    JacobiIterable{eltype(x), typeof(x)}(OffDiagonal(A, DiagonalIndices(A)), x, similar(x), b, maxiter)</code></pre><p>Now if you apply Jacobi iteration multiple times with the same matrix for just a few iterations, it makes sense to initialize the iterable only once and reuse it afterwards:</p><pre><code class="language-julia-repl hljs">julia&gt; using LinearAlgebra, SparseArrays, IterativeSolvers

julia&gt; A = spdiagm(-1 =&gt; -ones(3), 0 =&gt; 2*ones(4), 1 =&gt; -ones(3));

julia&gt; b1 = [1.0, 2, 3, 4];

julia&gt; b2 = [-1.0, 1, -1, 1];

julia&gt; x = [0.0, -1, 1, 0];

julia&gt; my_iterable = IterativeSolvers.jacobi_iterable(x, A, b1, maxiter = 2);

julia&gt; norm(b1 - A * x) / norm(b1)
1.2909944487358056

julia&gt; for item in my_iterable
           println(&quot;Iteration for rhs 1&quot;)
       end
Iteration for rhs 1
Iteration for rhs 1

julia&gt; norm(b1 - A * x) / norm(b1)
0.8228507357554791

julia&gt; # Copy the next right-hand side into the iterable
       copyto!(my_iterable.b, b2);

julia&gt; norm(b2 - A * x) / norm(b2)
2.6368778887161235

julia&gt; for item in my_iterable
           println(&quot;Iteration for rhs 2&quot;)
       end
Iteration for rhs 2
Iteration for rhs 2

julia&gt; norm(b2 - A * x) / norm(b2)
1.610815496107484</code></pre><h2 id="Other-use-cases"><a class="docs-heading-anchor" href="#Other-use-cases">Other use cases</a><a id="Other-use-cases-1"></a><a class="docs-heading-anchor-permalink" href="#Other-use-cases" title="Permalink"></a></h2><p>Other use cases include:</p><ul><li>computing the (harmonic) Ritz values from the Hessenberg matrix in GMRES;</li><li>comparing the approximate residual of methods such as GMRES and BiCGStab(l) with the true residual during the iterations;</li><li>updating a preconditioner in flexible methods.</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../svd/svdl/">« SVDL</a><a class="docs-footer-nextpage" href="../about/CONTRIBUTING/">Contributing »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.5.0 on <span class="colophon-date" title="Friday 2 August 2024 15:39">Friday 2 August 2024</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
